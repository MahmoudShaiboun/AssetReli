"use strict";(self.webpackChunkaastreli_frontend=self.webpackChunkaastreli_frontend||[]).push([[482],{4482(e,t,l){l.r(t),l.d(t,{default:()=>V});var r=l(2555),s=l(5043),n=l(9252),i=l(1637),a=l(6446),d=l(5865),o=l(1906),c=l(547),u=l(9650),h=l(3336),A=l(1806),x=l(4882),p=l(8076),v=l(39),j=l(3460),g=l(3845),m=l(3193),f=l(9285),y=l(2143),_=l(7392),C=l(35),b=l(6600),w=l(5316),k=l(5795),W=l(9190),S=l(9347),P=l(2505),O=l(3159),I=l(5054),z=l(6624),E=l(579);const T={title:"",description:"",priority:"medium",status:"open",assigned_to:"",related_event_id:""},F={critical:"error",high:"warning",medium:"info",low:"success"},M={open:"warning",in_progress:"info",completed:"success",cancelled:"default"},D={open:"Open",in_progress:"In Progress",completed:"Completed",cancelled:"Cancelled"};function V(){const{tenantVersion:e}=(0,z.n8)(),[t,l]=(0,s.useState)([]),[V,L]=(0,s.useState)(!0),[R,q]=(0,s.useState)(null),[H,N]=(0,s.useState)(null),[B,G]=(0,s.useState)(!1),[J,U]=(0,s.useState)(!1),[K,Q]=(0,s.useState)(T),[X,Y]=(0,s.useState)(null),Z=async()=>{try{const{data:e}=await I.Ay.get("/alerts/work-orders");l(Array.isArray(e)?e:e.work_orders||[])}catch(r){var e,t;q((null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Failed to load work orders")}finally{L(!1)}};(0,s.useEffect)(()=>{Z()},[e]);const $=e=>{try{return new Date(e).toLocaleString()}catch(t){return e}};return V?(0,E.jsx)(n.A,{maxWidth:"lg",sx:{mt:4,display:"flex",justifyContent:"center"},children:(0,E.jsx)(i.A,{})}):(0,E.jsxs)(n.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,E.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,E.jsx)(d.A,{variant:"h4",children:"Work Orders"}),(0,E.jsx)(o.A,{variant:"contained",startIcon:(0,E.jsx)(P.A,{}),onClick:()=>{Q(T),Y(null),q(null),G(!0)},children:"Create Work Order"})]}),H&&(0,E.jsx)(c.A,{severity:"success",sx:{mb:2},onClose:()=>N(null),children:H}),R&&!B&&(0,E.jsx)(c.A,{severity:"error",sx:{mb:2},onClose:()=>q(null),children:R}),(0,E.jsx)(u.A,{component:h.A,children:(0,E.jsxs)(A.A,{children:[(0,E.jsx)(x.A,{children:(0,E.jsxs)(p.A,{children:[(0,E.jsx)(v.A,{children:(0,E.jsx)("strong",{children:"Title"})}),(0,E.jsx)(v.A,{children:(0,E.jsx)("strong",{children:"Priority"})}),(0,E.jsx)(v.A,{children:(0,E.jsx)("strong",{children:"Status"})}),(0,E.jsx)(v.A,{children:(0,E.jsx)("strong",{children:"Assigned To"})}),(0,E.jsx)(v.A,{children:(0,E.jsx)("strong",{children:"Created At"})}),(0,E.jsx)(v.A,{children:(0,E.jsx)("strong",{children:"Actions"})})]})}),(0,E.jsx)(j.A,{children:0===t.length?(0,E.jsx)(p.A,{children:(0,E.jsx)(v.A,{colSpan:6,align:"center",children:(0,E.jsx)(d.A,{variant:"body2",color:"text.secondary",sx:{py:4},children:'No work orders found. Click "Create Work Order" to get started.'})})}):t.map(e=>(0,E.jsxs)(p.A,{hover:!0,children:[(0,E.jsxs)(v.A,{children:[(0,E.jsx)(d.A,{variant:"body2",fontWeight:600,children:e.title}),e.description&&(0,E.jsx)(d.A,{variant:"caption",color:"text.secondary",display:"block",noWrap:!0,sx:{maxWidth:250},title:e.description,children:e.description})]}),(0,E.jsx)(v.A,{children:(0,E.jsx)(g.A,{label:e.priority,size:"small",color:F[e.priority]||"default"})}),(0,E.jsx)(v.A,{children:(0,E.jsx)(m.A,{size:"small",variant:"standard",sx:{minWidth:120},children:(0,E.jsxs)(f.A,{value:e.status,onChange:t=>(async(e,t)=>{try{await I.Ay.patch("/alerts/work-orders/".concat(e),{status:t}),N("Status updated successfully"),setTimeout(()=>N(null),4e3),await Z()}catch(s){var l,r;q((null===(l=s.response)||void 0===l||null===(r=l.data)||void 0===r?void 0:r.detail)||"Failed to update status")}})(e.id,t.target.value),renderValue:e=>(0,E.jsx)(g.A,{label:D[e]||e,size:"small",color:M[e]||"default"}),children:[(0,E.jsx)(y.A,{value:"open",children:"Open"}),(0,E.jsx)(y.A,{value:"in_progress",children:"In Progress"}),(0,E.jsx)(y.A,{value:"completed",children:"Completed"}),(0,E.jsx)(y.A,{value:"cancelled",children:"Cancelled"})]})})}),(0,E.jsx)(v.A,{children:e.assigned_to||"\u2014"}),(0,E.jsx)(v.A,{sx:{whiteSpace:"nowrap"},children:$(e.created_at)}),(0,E.jsx)(v.A,{children:(0,E.jsx)(_.A,{size:"small",onClick:()=>(e=>{Q({title:e.title,description:e.description||"",priority:e.priority,status:e.status,assigned_to:e.assigned_to||"",related_event_id:e.related_event_id||""}),Y(e.id),q(null),G(!0)})(e),title:"Edit",children:(0,E.jsx)(O.A,{fontSize:"small"})})})]},e.id))})]})}),(0,E.jsxs)(C.A,{open:B,onClose:()=>G(!1),maxWidth:"sm",fullWidth:!0,children:[(0,E.jsx)(b.A,{children:X?"Edit Work Order":"Create Work Order"}),(0,E.jsxs)(w.A,{children:[R&&B&&(0,E.jsx)(c.A,{severity:"error",sx:{mb:2,mt:1},onClose:()=>q(null),children:R}),(0,E.jsx)(k.A,{fullWidth:!0,required:!0,label:"Title",value:K.title,onChange:e=>Q((0,r.A)((0,r.A)({},K),{},{title:e.target.value})),sx:{mt:2,mb:2},placeholder:"e.g. Replace Pump Bearing"}),(0,E.jsx)(k.A,{fullWidth:!0,label:"Description",value:K.description,onChange:e=>Q((0,r.A)((0,r.A)({},K),{},{description:e.target.value})),sx:{mb:2},multiline:!0,rows:3,placeholder:"Detailed description of the work to be done"}),(0,E.jsxs)(m.A,{fullWidth:!0,sx:{mb:2},children:[(0,E.jsx)(W.A,{children:"Priority"}),(0,E.jsxs)(f.A,{value:K.priority,label:"Priority",onChange:e=>Q((0,r.A)((0,r.A)({},K),{},{priority:e.target.value})),children:[(0,E.jsx)(y.A,{value:"critical",children:"Critical"}),(0,E.jsx)(y.A,{value:"high",children:"High"}),(0,E.jsx)(y.A,{value:"medium",children:"Medium"}),(0,E.jsx)(y.A,{value:"low",children:"Low"})]})]}),(0,E.jsxs)(m.A,{fullWidth:!0,sx:{mb:2},children:[(0,E.jsx)(W.A,{children:"Status"}),(0,E.jsxs)(f.A,{value:K.status,label:"Status",onChange:e=>Q((0,r.A)((0,r.A)({},K),{},{status:e.target.value})),children:[(0,E.jsx)(y.A,{value:"open",children:"Open"}),(0,E.jsx)(y.A,{value:"in_progress",children:"In Progress"}),(0,E.jsx)(y.A,{value:"completed",children:"Completed"}),(0,E.jsx)(y.A,{value:"cancelled",children:"Cancelled"})]})]}),(0,E.jsx)(k.A,{fullWidth:!0,label:"Assigned To",value:K.assigned_to,onChange:e=>Q((0,r.A)((0,r.A)({},K),{},{assigned_to:e.target.value})),sx:{mb:2},placeholder:"e.g. John Smith"}),(0,E.jsx)(k.A,{fullWidth:!0,label:"Related Event ID (optional)",value:K.related_event_id,onChange:e=>Q((0,r.A)((0,r.A)({},K),{},{related_event_id:e.target.value})),placeholder:"Link to an alarm event",helperText:"Optional: associate this work order with a specific alarm event"})]}),(0,E.jsxs)(S.A,{sx:{px:3,pb:2},children:[(0,E.jsx)(o.A,{onClick:()=>{G(!1),q(null)},children:"Cancel"}),(0,E.jsx)(o.A,{variant:"contained",onClick:async()=>{if(K.title){U(!0),q(null);try{const e={title:K.title,description:K.description,priority:K.priority,status:K.status};K.assigned_to&&(e.assigned_to=K.assigned_to),K.related_event_id&&(e.related_event_id=K.related_event_id),X?(await I.Ay.patch("/alerts/work-orders/".concat(X),e),N('Work order "'.concat(K.title,'" updated successfully'))):(await I.Ay.post("/alerts/work-orders",e),N('Work order "'.concat(K.title,'" created successfully'))),setTimeout(()=>N(null),4e3),G(!1),Q(T),Y(null),await Z()}catch(l){var e,t;q((null===(e=l.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Failed to save work order")}finally{U(!1)}}else q("Title is required")},disabled:J||!K.title,children:J?"Saving...":X?"Update":"Create"})]})]})]})}},2505(e,t,l){var r=l(4994);t.A=void 0;var s=r(l(2420)),n=l(579);t.A=(0,s.default)((0,n.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},3159(e,t,l){var r=l(4994);t.A=void 0;var s=r(l(2420)),n=l(579);t.A=(0,s.default)((0,n.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},2420(e,t,l){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=l(4421)},4421(e,t,l){l.r(t),l.d(t,{capitalize:()=>s.A,createChainedFunction:()=>n,createSvgIcon:()=>i.A,debounce:()=>a.A,deprecatedPropType:()=>d,isMuiElement:()=>o.A,ownerDocument:()=>c.A,ownerWindow:()=>u.A,requirePropFactory:()=>h,setRef:()=>A,unstable_ClassNameGenerator:()=>y,unstable_useEnhancedEffect:()=>x.A,unstable_useId:()=>p.A,unsupportedProp:()=>v,useControlled:()=>j.A,useEventCallback:()=>g.A,useForkRef:()=>m.A,useIsFocusVisible:()=>f.A});var r=l(9386),s=l(6803);const n=l(2456).A;var i=l(9662),a=l(950);const d=function(e,t){return()=>null};var o=l(7328),c=l(2427),u=l(6078);const h=function(e,t){return()=>null};const A=l(6564).A;var x=l(5013),p=l(5879);const v=function(e,t,l,r,s){return null};var j=l(4516),g=l(3319),m=l(5849),f=l(3574);const y={configure:e=>{r.A.configure(e)}}},5879(e,t,l){l.d(t,{A:()=>r});const r=l(5844).A}}]);
//# sourceMappingURL=482.27b6cbdc.chunk.js.map