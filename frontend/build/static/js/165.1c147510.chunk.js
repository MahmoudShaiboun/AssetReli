"use strict";(self.webpackChunkaastreli_frontend=self.webpackChunkaastreli_frontend||[]).push([[165],{1446(e,t,r){r.d(t,{o:()=>n});var o=r(4558);const n=e=>{const t=localStorage.getItem("aastreli_token"),r=t?"".concat(o.Z,"/stream?token=").concat(t):"".concat(o.Z,"/stream"),n=new WebSocket(r);return n.onopen=()=>{console.log("WebSocket connected")},n.onmessage=t=>{try{const r=JSON.parse(t.data);e(r)}catch(r){console.error("WebSocket message parse error:",r)}},n.onerror=e=>{console.error("WebSocket error:",e)},n.onclose=e=>{console.log("WebSocket disconnected",4001===e.code?"(auth failed)":"")},n}},3165(e,t,r){r.r(t),r.d(t,{default:()=>T});var o=r(5043),n=r(5865),i=r(9252),s=r(6446),l=r(3845),a=r(8903),d=r(2110),c=r(6494),m=r(3336),x=r(1327),h=r(6150),u=r(108),p=r(7734),j=r(168),v=r(3839),A=r(2185),y=r(6026),g=r(5748),b=r(877),_=r(5054),f=r(1446),k=r(6624),S=r(579);function T(){var e,t,r,T;const{tenantVersion:w}=(0,k.n8)(),[B,W]=(0,o.useState)(null),[C,D]=(0,o.useState)(!0),[E,F]=(0,o.useState)({}),[N,L]=(0,o.useState)([]),[M,P]=(0,o.useState)(!1);(0,o.useEffect)(()=>{const e=async()=>{try{const e=await(0,_.ZW)();W(e)}catch(e){console.error("Error fetching dashboard:",e)}finally{D(!1)}};e();const t=setInterval(e,5e3);return()=>clearInterval(t)},[w]),(0,o.useEffect)(()=>{const e=async()=>{try{const e=await _.Ay.get("/sensor-readings",{params:{skip:0,limit:50}}),t=(e.data.readings||[]).reverse().map(e=>{var t,r,o,n,i,s,l,a,d,c,m,x;let h=e.timestamp||"";h.endsWith("Z")||h.includes("+")||(h+="Z");return{timestamp:new Date(h).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),motor_temp:null!==(t=null!==(r=null===(o=e.motor_data)||void 0===o?void 0:o.DE_temp)&&void 0!==r?r:e.temperature)&&void 0!==t?t:0,motor_vib:null!==(n=null!==(i=null===(s=e.motor_data)||void 0===s?void 0:s.DE_vib_band_1)&&void 0!==i?i:e.vibration)&&void 0!==n?n:0,pump_temp:null!==(l=null!==(a=null===(d=e.pump_data)||void 0===d?void 0:d.DE_temp)&&void 0!==a?a:e.pressure)&&void 0!==l?l:0,pump_ultra:null!==(c=null!==(m=null===(x=e.pump_data)||void 0===x?void 0:x.DE_ultra)&&void 0!==m?m:e.humidity)&&void 0!==c?c:0,prediction:e.prediction,confidence:e.confidence,sensor_id:e.sensor_id}});L(t)}catch(e){console.error("Error fetching historical data:",e)}};e();const t=setInterval(e,5e3);return()=>clearInterval(t)},[w]),(0,o.useEffect)(()=>{let e=!1,t=null;const r=setTimeout(()=>{e||(t=(0,f.o)(t=>{e||(F(t),P(!0))}),t.onclose=()=>{e||P(!1)})},0);return()=>{e=!0,clearTimeout(r),t&&t.close()}},[w]);const I=(()=>{var e;const t=N.length>0?N[N.length-1].prediction:null,r=null===(e=Object.values(E)[0])||void 0===e?void 0:e.data;var o,n,i,s;if(r)return{motorTemp:null!==(o=r.motor_DE_temp_c)&&void 0!==o?o:r.temperature,motorVib:null!==(n=r.motor_DE_vib_band_1)&&void 0!==n?n:r.vibration,pumpTemp:null!==(i=r.pump_DE_temp_c)&&void 0!==i?i:r.pressure,pumpUltra:null!==(s=r.pump_DE_ultra_db)&&void 0!==s?s:r.humidity,prediction:t,state:r.state};if(N.length>0){const e=N[N.length-1];return{motorTemp:e.motor_temp,motorVib:e.motor_vib,pumpTemp:e.pump_temp,pumpUltra:e.pump_ultra,prediction:e.prediction,state:null}}return null})();return C?(0,S.jsx)(n.A,{children:"Loading..."}):(0,S.jsxs)(i.A,{maxWidth:"xl",sx:{mt:4,mb:4},children:[(0,S.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,S.jsx)(n.A,{variant:"h4",children:"Industrial Anomaly Detection Dashboard"}),(0,S.jsx)(l.A,{label:M?"Real-time Connected":"Offline",color:M?"success":"error"})]}),(0,S.jsxs)(a.Ay,{container:!0,spacing:3,children:[(0,S.jsx)(a.Ay,{item:!0,xs:12,md:3,children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(c.A,{children:[(0,S.jsx)(n.A,{color:"textSecondary",gutterBottom:!0,children:"Total Predictions"}),(0,S.jsx)(n.A,{variant:"h3",children:(null===B||void 0===B?void 0:B.total_predictions)||0})]})})}),(0,S.jsx)(a.Ay,{item:!0,xs:12,md:3,children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(c.A,{children:[(0,S.jsx)(n.A,{color:"textSecondary",gutterBottom:!0,children:"Feedback Collected"}),(0,S.jsx)(n.A,{variant:"h3",children:(null===B||void 0===B?void 0:B.total_feedback)||0})]})})}),(0,S.jsx)(a.Ay,{item:!0,xs:12,md:3,children:(0,S.jsx)(d.A,{sx:{bgcolor:"normal"===(null===I||void 0===I?void 0:I.prediction)?"success.light":"warning.light"},children:(0,S.jsxs)(c.A,{children:[(0,S.jsx)(n.A,{color:"textSecondary",gutterBottom:!0,children:"Latest ML Prediction"}),(0,S.jsx)(n.A,{variant:"h5",children:(null===I||void 0===I?void 0:I.prediction)||"Waiting..."})]})})}),(0,S.jsx)(a.Ay,{item:!0,xs:12,md:3,children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(c.A,{children:[(0,S.jsx)(n.A,{color:"textSecondary",gutterBottom:!0,children:"System Health"}),(0,S.jsx)(n.A,{variant:"h3",color:"success.main",children:"Online"})]})})}),I&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(a.Ay,{item:!0,xs:12,md:3,children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(c.A,{children:[(0,S.jsx)(n.A,{color:"textSecondary",gutterBottom:!0,children:"Motor Temp"}),(0,S.jsxs)(n.A,{variant:"h4",children:[(null===(e=I.motorTemp)||void 0===e?void 0:e.toFixed(1))||"N/A","\xb0C"]})]})})}),(0,S.jsx)(a.Ay,{item:!0,xs:12,md:3,children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(c.A,{children:[(0,S.jsx)(n.A,{color:"textSecondary",gutterBottom:!0,children:"Motor Vibration"}),(0,S.jsxs)(n.A,{variant:"h4",children:[(null===(t=I.motorVib)||void 0===t?void 0:t.toFixed(2))||"N/A"," Hz"]})]})})}),(0,S.jsx)(a.Ay,{item:!0,xs:12,md:3,children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(c.A,{children:[(0,S.jsx)(n.A,{color:"textSecondary",gutterBottom:!0,children:"Pump Temp"}),(0,S.jsxs)(n.A,{variant:"h4",children:[(null===(r=I.pumpTemp)||void 0===r?void 0:r.toFixed(1))||"N/A","\xb0C"]})]})})}),(0,S.jsx)(a.Ay,{item:!0,xs:12,md:3,children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(c.A,{children:[(0,S.jsx)(n.A,{color:"textSecondary",gutterBottom:!0,children:"Pump Ultrasonic"}),(0,S.jsxs)(n.A,{variant:"h4",children:[(null===(T=I.pumpUltra)||void 0===T?void 0:T.toFixed(1))||"N/A"," dB"]})]})})})]}),(0,S.jsx)(a.Ay,{item:!0,xs:12,md:6,children:(0,S.jsxs)(m.A,{sx:{p:2},children:[(0,S.jsx)(n.A,{variant:"h6",gutterBottom:!0,children:"Motor Temperature Trend"}),(0,S.jsx)(u.u,{width:"100%",height:250,children:(0,S.jsxs)(b.Q,{data:N,children:[(0,S.jsx)(p.d,{strokeDasharray:"3 3"}),(0,S.jsx)(A.W,{dataKey:"timestamp"}),(0,S.jsx)(y.h,{}),(0,S.jsx)(h.m,{}),(0,S.jsx)(x.s,{}),(0,S.jsx)(v.G,{type:"monotone",dataKey:"motor_temp",stroke:"#ff7300",fill:"#ff7300",fillOpacity:.6,name:"Motor Temp (\xb0C)"})]})})]})}),(0,S.jsx)(a.Ay,{item:!0,xs:12,md:6,children:(0,S.jsxs)(m.A,{sx:{p:2},children:[(0,S.jsx)(n.A,{variant:"h6",gutterBottom:!0,children:"Motor Vibration Trend"}),(0,S.jsx)(u.u,{width:"100%",height:250,children:(0,S.jsxs)(g.b,{data:N,children:[(0,S.jsx)(p.d,{strokeDasharray:"3 3"}),(0,S.jsx)(A.W,{dataKey:"timestamp"}),(0,S.jsx)(y.h,{}),(0,S.jsx)(h.m,{}),(0,S.jsx)(x.s,{}),(0,S.jsx)(j.N,{type:"monotone",dataKey:"motor_vib",stroke:"#8884d8",strokeWidth:2,name:"Vibration (Hz)"})]})})]})}),(0,S.jsx)(a.Ay,{item:!0,xs:12,md:6,children:(0,S.jsxs)(m.A,{sx:{p:2},children:[(0,S.jsx)(n.A,{variant:"h6",gutterBottom:!0,children:"Pump Temperature Trend"}),(0,S.jsx)(u.u,{width:"100%",height:250,children:(0,S.jsxs)(b.Q,{data:N,children:[(0,S.jsx)(p.d,{strokeDasharray:"3 3"}),(0,S.jsx)(A.W,{dataKey:"timestamp"}),(0,S.jsx)(y.h,{}),(0,S.jsx)(h.m,{}),(0,S.jsx)(x.s,{}),(0,S.jsx)(v.G,{type:"monotone",dataKey:"pump_temp",stroke:"#82ca9d",fill:"#82ca9d",fillOpacity:.6,name:"Pump Temp (\xb0C)"})]})})]})}),(0,S.jsx)(a.Ay,{item:!0,xs:12,md:6,children:(0,S.jsxs)(m.A,{sx:{p:2},children:[(0,S.jsx)(n.A,{variant:"h6",gutterBottom:!0,children:"Pump Ultrasonic Trend"}),(0,S.jsx)(u.u,{width:"100%",height:250,children:(0,S.jsxs)(g.b,{data:N,children:[(0,S.jsx)(p.d,{strokeDasharray:"3 3"}),(0,S.jsx)(A.W,{dataKey:"timestamp"}),(0,S.jsx)(y.h,{}),(0,S.jsx)(h.m,{}),(0,S.jsx)(x.s,{}),(0,S.jsx)(j.N,{type:"monotone",dataKey:"pump_ultra",stroke:"#ffc658",strokeWidth:2,name:"Ultrasonic (dB)"})]})})]})}),(0,S.jsx)(a.Ay,{item:!0,xs:12,children:(0,S.jsxs)(m.A,{sx:{p:2},children:[(0,S.jsx)(n.A,{variant:"h6",gutterBottom:!0,children:"Recent ML Predictions & Anomalies (Live)"}),(0,S.jsx)(s.A,{sx:{maxHeight:400,overflow:"auto"},children:0===N.length?(0,S.jsx)(n.A,{variant:"body2",color:"textSecondary",sx:{p:2},children:"Waiting for sensor data..."}):N.slice(-15).reverse().map((e,t)=>{var r;const o=e.prediction&&"normal"!==e.prediction.toLowerCase();return(0,S.jsxs)(s.A,{sx:{p:2,mb:1,border:1,borderColor:o?"warning.main":"grey.300",bgcolor:o?"warning.light":"background.paper",borderRadius:1},children:[(0,S.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,S.jsxs)(n.A,{variant:"body2",children:[(0,S.jsx)("strong",{children:"Time:"})," ",e.timestamp," | ",(0,S.jsx)("strong",{children:"Sensor:"})," ",e.sensor_id||"N/A"]}),(0,S.jsxs)(s.A,{children:[o&&(0,S.jsx)(l.A,{label:"ANOMALY",color:"error",size:"small",sx:{mr:1}}),(0,S.jsx)(l.A,{label:e.prediction||"N/A",color:"normal"===(null===(r=e.prediction)||void 0===r?void 0:r.toLowerCase())?"success":"warning",size:"small",sx:{mr:1}}),null!=e.confidence&&(0,S.jsx)(l.A,{label:"".concat((100*e.confidence).toFixed(0),"%"),size:"small",color:e.confidence>.7?"success":"warning",variant:"outlined"})]})]}),(0,S.jsxs)(n.A,{variant:"caption",color:"textSecondary",children:["Motor: ",e.motor_temp.toFixed(1),"\xb0C, ",e.motor_vib.toFixed(2),"Hz | Pump: ",e.pump_temp.toFixed(1),"\xb0C, ",e.pump_ultra.toFixed(1),"dB"]})]},t)})})]})})]})]})}}}]);
//# sourceMappingURL=165.1c147510.chunk.js.map